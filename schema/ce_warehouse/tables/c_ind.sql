/*
 ***********************************************************************************************************
 * @file
 * c_ind.sql
 *
 * Control table - indicator details, used for validation & lookup.
 *
 * Defined as a control table because it's details pass into PowerBi schema.
 ***********************************************************************************************************
 */

-- DROP TABLE IF EXISTS ce_warehouse.c_ind;

CREATE TABLE IF NOT EXISTS ce_warehouse.c_ind
(
    pk_i INT GENERATED BY DEFAULT AS IDENTITY,
    i_code TEXT NOT NULL
        CHECK (i_code ~ '^[A-Z0-9][A-Z0-9<>._\-+#£$%]*[A-Z0-9#£€$%]$'),
    i_name TEXT NOT NULL,
    i_description TEXT,
    i_name1 TEXT,
    i_name2 TEXT,
    i_name3 TEXT,
    i_name4 TEXT,
    i_name_lower TEXT,
    i_name1_lower TEXT,
    i_name2_lower TEXT,
    i_name3_lower TEXT,
    i_name4_lower TEXT,
    i_catg_broad TEXT,
    i_catg_narrow TEXT,
    i_parent_icodes TEXT[],
    i_data_transformation TEXT NOT NULL
        REFERENCES ce_warehouse.l_data_transformation (code)
        ON DELETE NO ACTION,
    i_keyindicator BOOL NOT NULL DEFAULT FALSE,
    i_proprietary_data BOOL NOT NULL DEFAULT FALSE,
    i_order INT NOT NULL DEFAULT 0,
    internal_notes TEXT,  -- Internal notes, unvalidated!
    error TEXT,
    updated_utc TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    PRIMARY KEY (pk_i),
    UNIQUE (i_code)
);

COMMENT ON TABLE ce_warehouse.c_ind
    IS 'Control table - indicator details, used for validation & lookup';
