/*
 ***********************************************************************************************************
 * @file
 * c_geo.sql
 *
 * Control table - geography details, used for validation & extra detail.
 *
 * Originally just a lookup table, but due to its complexity it's been added to the control tables.
 ***********************************************************************************************************
 */

-- DROP TABLE IF EXISTS ce_warehouse.c_geo;

CREATE TABLE IF NOT EXISTS ce_warehouse.c_geo
(
    pk_geo INT GENERATED BY DEFAULT AS IDENTITY,

    code TEXT NOT NULL
        CHECK (code ~ '^G\.[A-Z0-9_]+[A-Z0-9]$' AND code !~ 'INTERNAL'),
    name TEXT NOT NULL,
    name2 TEXT NOT NULL,
    short_name TEXT NOT NULL,
    tla TEXT NOT NULL,
    iso2 TEXT,
    iso3 TEXT,
    lat NUMERIC,
    long NUMERIC,
    cb TEXT,
    cb_short TEXT,
    stockmarket TEXT,
    stockmarket_short TEXT,
    political_alignment TEXT,  -- VALIDATION: via application, foreign key is too much of a pain
    lc TEXT,
    lcu TEXT,
    flag TEXT,
    catg TEXT NOT NULL,  -- VALIDATION: via application, foreign key is too much of a pain
    groups TEXT[],
    ordering INT NOT NULL DEFAULT 0,
    internal_notes TEXT,  -- Unvalidated!

    error TEXT,
    updated_utc TIMESTAMPTZ NOT NULL DEFAULT NOW(),

    PRIMARY KEY (pk_geo),
    UNIQUE (code)
);

COMMENT ON TABLE ce_warehouse.c_geo
    IS 'Control table - geography details, used for validation & extra detail';
